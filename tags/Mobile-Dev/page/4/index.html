<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=en><![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang=en><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang=en><![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en><!--<![endif]--><head><meta charset=utf-8><title>Mobile Dev &#8211; Le murmure de Julian</title><meta name=description content><meta property="og:title" content="Mobile Dev"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://blog.jln.co/tags/Mobile-Dev/"><meta property="og:image" content="http://blog.jln.co/images/avatar.png"><meta property="og:updated_time" content="2014-08-20T00:24:16+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://blog.jln.co/images/avatar.png"><meta name=twitter:title content="Mobile Dev"><meta name=twitter:description content><link rel=canonical href=http://blog.jln.co/tags/Mobile-Dev/><link href=http://blog.jln.co/tags/Mobile-Dev/feed.xml rel=alternate type=application/rss+xml title="Le murmure de Julian"><link href=http://blog.jln.co/tags/Mobile-Dev/feed.xml rel=feed type=application/rss+xml title="Le murmure de Julian"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel=stylesheet type=text/css><meta http-equiv=cleartype content="on"><meta name=generator content="Hugo 0.73.0"><script src=/js/vendor/modernizr-2.6.2.custom.min.js></script><script async src=https://unpkg.com/mermaid@8.2.3/dist/mermaid.min.js></script><link rel="shortcut icon" href=/favicon.png></head><body id=post-index><nav id=dl-menu class=dl-menuwrapper role=navigation style=display:inline-block><button class=dl-trigger>Open Menu</button><ul class=dl-menu><li><a href=/>Home</a></li><li><a href=#>About</a><ul class=dl-submenu><li><img src=/images/avatar.png alt="Julian Shen's photo" class=author-photo><h4>Julian Shen</h4><p>Softward developer</p></li><li><a href=mailto:julianshen22@gmail.com><i class="fa fa-fw fa-envelope"></i>Email</a></li><li><a href=https://linkedin.com/in/julianshen><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li><li><a href=https://github.com/julianshen><i class="fa fa-fw fa-github"></i>GitHub</a></li><li><a href=https://instagram.com/julianshen><i class="fa fa-fw fa-instagram"></i>Instagram</a></li></ul></li><li><a href=#>Posts</a><ul class=dl-submenu><li><a href=/post/>All Posts</a></li><li><a href=/tags/>All Tags</a></li></ul></li><li><a href=/></a></li></ul></nav><div class=entry-header><div class=header-title><div class=header-title-wrap><h1><a href=/ title="Go to the homepage">Le murmure de Julian</a></h1><h2>Mobile Dev</h2></div></div></div><div id=main role=main><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-06-02 21:17:03 +0000 UTC"><a href=/Android%E7%AD%86%E8%A8%98-Background-update/>Jun 2, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~5 minutes</span></div><h1 class=entry-title><a href=/Android%E7%AD%86%E8%A8%98-Background-update/ rel=bookmark title="[Android][筆記] Background update" itemprop=url>[Android][筆記] Background update</a></h1></header><div class=entry-content><div class=posterous_autopost><p>今天跟人討論到關於Background update相關的問題, 這個議題一直是看似簡單(反正就是在backgroud抓資料), 但實際上很複雜也很難做的好</p><p>剛剛又拿了今年Google IO的<a href=http://static.googleusercontent.com/external_content/untrusted_dlcp/www.google.com/en//events/io/2011/static/presofiles/android_protips_advanced_topics_for_expert_android_app_developers.pdf>Android protips這session的投影片</a>複習了一下, 這個session裡剛好也有提到相關的內容, 就順便拿來借題發揮一下</p><p>為什麼要做background data update? 無非是 - Being Fresh</p><ul><li>讓user在想要看他所想看的資料時不用等待(Means never have to wait)</li><li>讓user可以隨時拿到最新的資料(Means always being up to date)</li></ul><p>原本投影片上有三點, 我簡化成兩點, 是我覺得2,3其實可以歸為同一類(把位置當成是一種資料來看), 對於資料導向的應用程式來說, 是提供user一個好的使用體驗的方式, 因為大部分的資料都在背景幫你先預取回來了</p><p>另外我再多加一點: 需要提供使用者有新資料通知(Notification)時, 如新郵件, 新回覆之類的</p><p>但其實在移動裝置上, 要實現這樣的東西, 其實考量點並不只是抓取資料這麼簡單, 移動裝置通常意味著有較少的資源(運算能力, 記憶體, 儲存空間等等), 可能有限的且昂貴的網路環境(lower bandwidth, high data rate), 以及有限的電量(battery life)</p><p>第一點, 在現在高端手機的硬體競賽之下, 移動裝置其實已經漸漸的不比PC, Notebook來的差了, 雙核甚至四核的CPU, 更多的RAM, 儲存空間或許還有點距離, 不過也是越來越大, 這點, 變成比較不是問題, 更多的資源意味著可以容納更多的事情一起進行, 包含background update, 但相對的也意味的, 越來越耗費電源, 現行的電池科技並未進步到可以提供這麼大量的消耗, 因此移動裝置可以使用的時間會因此越來越短, 也會影響到整體的實用性</p><p>至於網路環境方面, 台灣的3G收費還不算貴, 多則不到一千就可以擁有無限制的data rate (吃到飽), 但並不是所有的地方都擁有這樣的環境, 很多國家, 資料總額還是有上限, 雖然大多已經相當的夠用了, 但多餘的資料抓取, 可能還是會變成無形中在偷使用者的荷包, 再者, 雖然電信商在智慧型手機流行的今天, 提供更多資料型的資費方案可選擇, 但大部分的電信商並沒預算好由於智慧型手機所帶來的網路流量, 有些電信商本身的infrastructure並不好, 越來越多的資料流量反而造成網路負擔不起</p><p>因此, 針對background update這類的設計, battery life跟資料量就是很重要的考量點</p><p>在這份投影片中提到"When is the best time to update your app&rsquo;s data":</p><ul><li>在還有電時 Provided they still have battery (不知道是我翻譯不好, 總覺有點廢話, 應該要是在電量還在某一定程度之上吧)</li><li>有網路時 They have connectivty and bandwidth (大部分的background update都是要從網路上抓取資料, 因此在沒網路時還要去抓取資料, 當然很不經濟)</li></ul><p>這兩點, 主要還是都是針對電力的角度</p><p>根據過去做的經驗, 這樣其實並不是很夠, 在Android上允許很多background processes, 這有時來說是種災難, 每個processes可能都要此起彼落的起來抓取資料, 就算還有電源, 還是會加速電力的消耗, 即使是接著電源, 也可能會導致充電效率變低, iPhone 4其中一個讓我最印象深刻的是充電效率, 其實不只是電源要能夠持久, 充電效率高也是很重要的, 那代表user可以花比較少的時間回復到他正常使用的狀態</p><p>在"Monitor device state to vary refresh rate"裡面有更進階的提到幾點:</p><ul><li>Update without connectivity?</li><li>More updates when on Wifi?</li><li>More updates when on charging?</li><li>Suspend update when battery is low</li><li>Mote updates when docked</li><li>Suspend update when in car dock</li></ul><p>基本上這幾點都是很實用的設計, 不過, 真正實行起來會發現, background update的學問可能還比這多很多, 例如上面所說充電的問題, 也就表示說, 並不是充電時多抓點東西就是好事, 而且多抓點東西也表示需要消耗更多的網路頻寬, 撇開資費和電信商的頻寬不說, 當user如果正在使用網路, 比如說瀏覽網頁, 看影片, 這時候如果背景也在狂抓取資料, 就有可能影響到user在前景的使用</p><p>我覺得, 還有更根本的問題, 比如說, 到底是要啥時抓, 多久抓一次資料才足夠, 要抓多少資料才足夠, 抓資料的次數越頻繁, 抓取的資料量越多, 代表裝置要耗費更多原本可以休息的時間來處理, 這方面可能得從整體設計面來考量, 先分析出有哪些資料需要background update, 這些資料在遠端被更新的頻率有多高(藉由此來決定到底更新頻率多高才是合理), 每一種資料需要的即時性不同, 有些資料久久才會有變化, 有些資料則很快, 如果很久才變化的資料, 沒事就去更新, 不但耗電, 而且浪費資料頻寬, 甚至這些資料你有沒在背景更新, 使用者也不會有任何感覺, 另外一個是資料量的問題, 如何縮減傳輸的資料量, 一方面是節省頻寬, 更重要的是節省每次抓取資料的時間, 這樣耗費的電量也才可以更少</p><p>iOS4上雖然也允許了<a href=http://developer.apple.com/library/ios/#documentation/iphone/conceptual/iphoneosprogrammingguide/BackgroundExecution/BackgroundExecution.html>Background task</a>, 但它的限制就高上很多, 很多需要做背景更新的, 還是透過push來達成居多, 不過push的方式在某方面來說可以減少不必要的update(比如說, 如果資料沒更新的話, pull的方式還是會上server去抓, push的方式則無這種無意義的浪費), 但設計不好的話, 其實也是會造成同樣的問題的&mldr;.</p><p> </p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-14 15:27:41 +0000 UTC"><a href=/AndroidTip-How-Twitter-for-Android-implements-auto-completion-in-post-screen/>May 14, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~1 minute</span></div><h1 class=entry-title><a href=/AndroidTip-How-Twitter-for-Android-implements-auto-completion-in-post-screen/ rel=bookmark title="[Android][Tip] How Twitter for Android implements auto completion in post screen?" itemprop=url>[Android][Tip] How Twitter for Android implements auto completion in post screen?</a></h1></header><div class=entry-content><div class=posterous_autopost><p>Twitter for Android popup a user list when you enter &ldquo;@&rdquo; in post screen. Like this:</p><div class="p_embed p_image_embed"><a href=http://posterous.com/getfile/files.posterous.com/temp-2011-05-14/sBGyFmhynhgeFmfsfCqjzIqEuBCwzpzkbhcwhuHnroxdmiHtylrzHyCtpeJD/t1.png.scaled1000.png><img alt=T1 height=455 src=http://posterous.com/getfile/files.posterous.com/temp-2011-05-14/sBGyFmhynhgeFmfsfCqjzIqEuBCwzpzkbhcwhuHnroxdmiHtylrzHyCtpeJD/t1.png.scaled500.png width=500></a></div><p>How it implement such feature? The solution can&rsquo;t be simpler - You could use <strong><span style=font-size:medium><a href=http://developer.android.com/reference/android/widget/MultiAutoCompleteTextView.html>MultiAutoCompeleteTextView</a></span></strong> to do this.</p><p>Here is the sample codes:</p><p><script src="https://gist.github.com/972014.js?file=gistfile1.java"></script></p><p>And the result:</p><div class="p_embed p_image_embed"><img alt=T2 height=554 src=http://posterous.com/getfile/files.posterous.com/temp-2011-05-14/jokbfzsgrCCDIirGFyluGlsiqwbpDsasxnvvGxlbmCjfHhdInJzDvogofucm/t2.png.scaled500.png width=475></div><p>To use this widget, you need to implement a Tokenizer to tell it where the sub text is. In this case, just find the string between &rsquo;@&rsquo; and space.</p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-10 14:19:21 +0000 UTC"><a href=/Generating-Facebook-key-hash-for-Android/>May 10, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~1 minute</span></div><h1 class=entry-title><a href=/Generating-Facebook-key-hash-for-Android/ rel=bookmark title="Generating Facebook key hash for Android" itemprop=url>Generating Facebook key hash for Android</a></h1></header><div class=entry-content><div class=posterous_autopost><p>According to<a href=http://developers.facebook.com/docs/guides/mobile/#android> Facebook mobile development document</a> (Android), you need to generate a key hash for your application in order to apply Facebook SSO(Single Sign on).</p><p>Here is the formal way to do this:</p><blockquote><p><span style=color:#9c0>keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore | openssl sha1 -binary | openssl base64</span></p></blockquote><p>But sometimes you won&rsquo;t have a tradtional key store especially when building with Android open sources. Keys in Android open sources are in pk8 format. In order to generate key hashes with these keys, you need to tranfer them into a pk12 key store.</p><p>I created another way to generate keyhash without <em><strong>keytool</strong></em> and <em><strong>openssl</strong></em>. Here is the source codes: <a href=https://github.com/julianshen/FacebookKeyHashGen>FacebookKeyHashGen</a></p><p>This program get package sigature directly from package itself. </p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-09 00:34:09 +0000 UTC"><a href=/POC%E7%AD%86%E8%A8%98Rhino-on-Android-%E6%96%B0%E7%9A%84onClickListener/>May 9, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~3 minutes</span></div><h1 class=entry-title><a href=/POC%E7%AD%86%E8%A8%98Rhino-on-Android-%E6%96%B0%E7%9A%84onClickListener/ rel=bookmark title="[POC][筆記][Rhino on Android] - 新的onClickListener" itemprop=url>[POC][筆記][Rhino on Android] - 新的onClickListener</a></h1></header><div class=entry-content><div class=posterous_autopost><p><a href=http://julianshen.posterous.com/pocrhino-developing-android-with-js-onclickli>上次的作法</a>:</p><blockquote><p><span style=color:maroon>var</span> button1 = findview(R.id(<span style=color:#36f>&lsquo;button1&rsquo;</span>));</p><p>button1.setOnClickListener(<span style=color:maroon>function</span>(view, methodName)<br>{<br>     if (methodName == <span style=color:#36f>&ldquo;onClick&rdquo;</span>) {<br>         log(&ldquo;MyScript&rdquo;, &ldquo;clicked&rdquo;);<br>} });</p></blockquote><p>當然不是很滿意, &ldquo;if(methodName == "onClick&rdquo;)&ldquo;這樣的寫法太醜了啦!</p><p>所以這次的目標是:</p><blockquote class=posterous_short_quote><p>button1.onclick = function(view) {</p><p>     log("MyScript&rdquo;, &ldquo;clicked&rdquo;);</p><p>     alert('Hi there!&rsquo;);</p><p>};</p></blockquote><p>這樣比較像印象中javascript的寫法</p><p>為了達到這目的, 必須在View中加入onclick這個property, 但原本View class(Java)並沒這東西, 如何將它包裝出來?</p><p>Rhino對於Javascript使用原生的java objects並不是直接使用, 還是有透過一層包裝, 因此這就是要做出這個property的路了, 包裝的點在於<a href=http://www.mozilla.org/rhino/apidocs/org/mozilla/javascript/WrapFactory.html>WrapFactory</a>, 而原生的Java object會被包裝長NativeJavaObject </p><p>而Rhino允許我們用自己的WrapFactory取代原本的, 像是這樣:</p><blockquote><p>jsContext.setWrapFactory(new <strong><span style=color:#f60>AndroidWrapFactory()</span></strong>);</p></blockquote><p>因此我們會需要自己實作這一個AndroidWrapFactory, 把原本的View改用不同的包裝, 而非原本的NativeJavaObject, 基本上只需要實作wrapAsJavaObject即可:</p><p><script src="https://gist.github.com/961470.js?file=AndroidWrapFactory.java"></script></p><p>這邊用了一個新實作的ViewWrapper來取代NativeJavaObject</p><p><script src="https://gist.github.com/961471.js?file=ViewWrapper.java"></script></p><p>本來我的打算是繼承自NativeJavaObject, 然後再加入自己的東西, 不過後來發現這樣的作法總會在"put"時出差錯, 原因是NativeJavaObject是沒辦法加入新的member了(其實這說法有點問題, 應該是只要設prototype給它的話還是可以), 加上一些比較實用的function是定義在ScriptableObject的裡面, 因此, 我最後採用ScriptableObject來包裝</p><p>但要如何在ScriptableObject裡面實現像NativeJavaObject那樣可以直接叫用原本的Java class裡面的member呢?這部份不用自己實作, 只要把原本的NativeJavaObject當做這新的ViewWrapper的prototype就好了, 所以這邊constructor呼叫的super contructor是:</p><blockquote class=posterous_short_quote><p>public ScriptableObject(Scriptable scope, Scriptable prototype)</p><p>===> super(scope, new NativeJavaObject(scope, javaObject, staticType));</p></blockquote><p>defineProperty這包裝是從ScritableObject那邊改寫其中一個過來的, 主要是用來讓我們可以把這些"onlick",&ldquo;onlongclick"包裝成property, 在ViewWrapper可以實作getter和setter, 為了避免名稱上的混淆, 所以把getter的prefix定義成"jsget"而setter是"jsset&rdquo;</p><p>在onlick的setter中, 除了將function object存起來外, 還直接對原本包裝的View設一個OnClickListener, 動作則是執行這個Function object</p><p>最後, 前面的範例裡面有一個"alert('Hi! there&rsquo;)&ldquo;, 因此為了"alert()"多實作一個Alert.java出來(跟上面的無關啦), 這是source:</p><p><script src="https://gist.github.com/961481.js?file=Alert.java"></script></p><p>接下來的目標, </p><ul><li>包裝一個實際真的可以拿來開發的package, release 0.1 alpha</li><li>實作XmlHttpRequest</li><li>Adapter & AdapterView, Service & Provider</li></ul></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-05-03 12:35:19 +0000 UTC"><a href=/POC%E7%AD%86%E8%A8%98Rhino-Developing-Android-with-JS-onClickListener/>May 3, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~1 minute</span></div><h1 class=entry-title><a href=/POC%E7%AD%86%E8%A8%98Rhino-Developing-Android-with-JS-onClickListener/ rel=bookmark title="[POC][筆記][Rhino] Developing Android with JS - onClickListener" itemprop=url>[POC][筆記][Rhino] Developing Android with JS - onClickListener</a></h1></header><div class=entry-content><div class=posterous_autopost><p><a href=http://julianshen.posterous.com/poc-using-javascript-to-develop-android-activ>上次做的</a>僅止於setText這個簡單的動作, 那像是處理click這類的怎做?</p><p>先拿click來做範例, 在Android中, 如果要替一個view加上處理click動作要利用到View.setOnClickListener, 但setOnClickListener的參數是onClickListener, 這是一個java interface, 在Rhino中如何實作一個Java interface?</p><p>首先, 不要被Rhino的文件給騙了, 那有問題(還花了我一個晚上看 :( ), Rhino的source codes裡有個example目錄, 裡面有隻SwingApplication.js, 答案就在這邊</p><p>因此, onClick就會像是這樣:</p><blockquote><p><span style=color:maroon>var</span> button1 = findview(R.id(<span style=color:#36f>&lsquo;button1&rsquo;</span>));</p><p>button1.setOnClickListener(<span style=color:maroon>function</span>(view, methodName)<br>{<br>     if (methodName == <span style=color:#36f>&ldquo;onClick&rdquo;</span>) {<br>         log(&ldquo;MyScript&rdquo;, &ldquo;clicked&rdquo;);<br>} });</p></blockquote><p>在這function內, 必須要自己判斷methodName來知道是哪個method被呼叫到, 應該是所有的java interface都可以用這樣去實作</p><p>OK, 這樣&mldr;很醜&mldr;繼續改進</p></div></div></article><div class=pagination><ul class=inline-list><li><a href=/tags/Mobile-Dev/page/3/ class=btn>Previous</a></li><li><a href=/tags/Mobile-Dev/>1</a></li><li><a href=/tags/Mobile-Dev/page/2/>2</a></li><li><a href=/tags/Mobile-Dev/page/3/>3</a></li><li><strong class=current-page>4</strong></li><li><a href=/tags/Mobile-Dev/page/5/>5</a></li><li><a href=/tags/Mobile-Dev/page/6/>6</a></li><li><a href=/tags/Mobile-Dev/page/7/>7</a></li><li><a href=/tags/Mobile-Dev/page/8/>8</a></li><li><a href=/tags/Mobile-Dev/page/9/>9</a></li><li><a href=/tags/Mobile-Dev/page/5/ class=btn>Next</a></li></ul></div></div><div class=footer-wrapper><footer role=contentinfo><span>Powered by <a href=https://gohugo.io/ rel=nofollow>Hugo</a> using the <a href=https://github.com/dldx/hpstr-hugo-theme rel=nofollow>HPSTR theme</a>.</span></footer></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://kit.fontawesome.com/872a53b461.js crossorigin=anonymous></script><script>window.jQuery||document.write('<script src="\/js\/vendor\/jquery-1.9.1.min.js"><\/script>')</script><script src=/js/scripts.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-79243751-1','auto');ga('send','pageview');}</script><div id=fb-root></div><script async defer crossorigin=anonymous src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=293999444006555&autoLogAppEvents=1" nonce=geZSUIUh></script></body></html>
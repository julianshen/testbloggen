<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=en><![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang=en><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang=en><![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en><!--<![endif]--><head><meta charset=utf-8><title>heroku &#8211; Le murmure de Julian</title><meta name=description content><meta property="og:title" content="heroku"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://blog.jln.co/tags/heroku/"><meta property="og:image" content="http://blog.jln.co/images/avatar.png"><meta property="og:updated_time" content="2017-02-04T16:17:19+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://blog.jln.co/images/avatar.png"><meta name=twitter:title content="heroku"><meta name=twitter:description content><link rel=canonical href=http://blog.jln.co/tags/heroku/><link href=http://blog.jln.co/tags/heroku/feed.xml rel=alternate type=application/rss+xml title="Le murmure de Julian"><link href=http://blog.jln.co/tags/heroku/feed.xml rel=feed type=application/rss+xml title="Le murmure de Julian"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.css><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel=stylesheet type=text/css><meta http-equiv=cleartype content="on"><meta name=generator content="Hugo 0.73.0"><script src=/js/vendor/modernizr-2.6.2.custom.min.js></script><script async src=https://unpkg.com/mermaid@8.2.3/dist/mermaid.min.js></script><link rel="shortcut icon" href=/favicon.png></head><body id=post-index><nav id=dl-menu class=dl-menuwrapper role=navigation style=display:inline-block><button class=dl-trigger>Open Menu</button><ul class=dl-menu><li><a href=/>Home</a></li><li><a href=#>About</a><ul class=dl-submenu><li><img src=/images/avatar.png alt="Julian Shen's photo" class=author-photo><h4>Julian Shen</h4><p>Softward developer</p></li><li><a href=mailto:julianshen22@gmail.com><i class="fa fa-fw fa-envelope"></i>Email</a></li><li><a href=https://linkedin.com/in/julianshen><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li><li><a href=https://github.com/julianshen><i class="fa fa-fw fa-github"></i>GitHub</a></li><li><a href=https://instagram.com/julianshen><i class="fa fa-fw fa-instagram"></i>Instagram</a></li></ul></li><li><a href=#>Posts</a><ul class=dl-submenu><li><a href=/post/>All Posts</a></li><li><a href=/tags/>All Tags</a></li></ul></li><li><a href=/></a></li></ul></nav><div class=entry-header><div class=header-title><div class=header-title-wrap><h1><a href=/ title="Go to the homepage">Le murmure de Julian</a></h1><h2>heroku</h2></div></div></div><div id=main role=main><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2017-02-04 16:17:19 +0000 UTC"><a href=/%E7%94%A8ifttt-heroku%E8%B7%91%E5%AE%9A%E6%99%82%E7%9A%84tasks/>Feb 4, 2017</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~2 minutes</span></div><h1 class=entry-title><a href=/%E7%94%A8ifttt-heroku%E8%B7%91%E5%AE%9A%E6%99%82%E7%9A%84tasks/ rel=bookmark title="用ifttt + heroku跑定時的tasks" itemprop=url>用ifttt + heroku跑定時的tasks</a></h1></header><div class=entry-content><p>這篇是延續&rdquo;<a href=http://blog.jln.co/%E4%BD%BF%E7%94%A8aws-lambda%E5%92%8Cgithub%E4%BE%86%E6%8F%90%E4%BE%9B%E4%B8%AD%E8%8F%AF%E8%81%B7%E6%A3%92%E8%B3%BD%E7%A8%8B%E8%B3%87%E6%96%99/>使用AWS lambda和Github來提供中華職棒賽程資料</a>&rdquo;,
之前的做法是用Cloud watch加上lambda來做這件事, 但我跑的東西並不是那麼的頻繁, 在AWS上還是會被收到流量的費用,
因此就打算用更經濟的方式, 利用heroku免費的額度來做這事(真是壞客戶 XD)</p><p>目的是定時(比如說每四小時)去爬一些網頁的資訊, 爬這些網頁其實也不需要花太久時間</p><p>用Cloud watch + lambda的好處是不用架一台server, 但用Heroku這種PAAS其實也不用太去管server這事</p><p>Heroku是可以設定<a href=https://devcenter.heroku.com/articles/scheduled-jobs-custom-clock-processes>scheduled tasks</a>的, 但額外的work dyno是要另外付費的,
因此, 如果需求不是需要太頻繁, 也不需要執行太久的, 這時候就可以利用<a href=https://ifttt.com/>ifttt</a>來定時觸發一個url的方式來做</p><p><img src=/images/posts/ifttt1.png alt></p><p>要定時觸發一個URL, ifttt applet該怎麼設定呢? 首先"this"要選用的是Date & Time, 如下:</p><p><img src=/images/posts/ifttt_time.png alt></p><p>設定上並沒有很多, 就像是每小時, 每天之類的, 沒辦法訂多個, 如果需要一次多個設定, 那就多新增幾個Applets吧</p><p><img src=/images/posts/ifttt_time_sel.png alt></p><p>這邊設定每小時, 就設定每小時的15分來觸發吧</p><p><img src=/images/posts/ifttt_set_time.png alt></p><p>那"that"的動作呢? 觸發URL的動作是利用"Maker&rdquo;, 這是設計給iot用的吧, 不過, 拿來做這用途也是沒問題的:</p><p><img src=/images/posts/ifttt_maker.png alt></p><p>Maker只有一個選項"Make a web request&rdquo;</p><p><img src=/images/posts/ifttt_choose_action.png alt></p><p>設定很單純, 就給定URL, 使用的HTTP Method(GET, POST, PUT &mldr;), Content-type, 跟Body</p><p><img src=/images/posts/ifttt_make_req.png alt></p><p>這邊我用的是POST + Json, Json裡面會帶一個TOKEN來辨識, 以免有心人士利用了這個URL, go的檢查範例如下:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>checkID</span>(<span style=color:#a6e22e>body</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) <span style=color:#66d9ef>bool</span> {
        <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>body</span>)

        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
        }

        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rbody</span> <span style=color:#66d9ef>struct</span> {
                <span style=color:#a6e22e>Id</span> <span style=color:#66d9ef>string</span>
        }
        <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>rbody</span>)

        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
        }

        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>rbody</span>.<span style=color:#a6e22e>Token</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;SEC_TOKEN&#34;</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>rbody</span>.<span style=color:#a6e22e>Token</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>
}
</code></pre></div><p>接到request後, 其實是可以把執行的task丟給另一個go routine處理, 原本的就可以回傳給ifttt, 避免執行太久而timeout的問題, 不過對heroku來說, 這還是在同一個web dyno上就是了</p></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2017-01-21 00:22:49 +0000 UTC"><a href=/%E5%9C%A8Heroku%E4%B8%8A%E7%94%A8apt-get%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6/>Jan 21, 2017</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~2 minutes</span></div><h1 class=entry-title><a href=/%E5%9C%A8Heroku%E4%B8%8A%E7%94%A8apt-get%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6/ rel=bookmark title=在Heroku上用apt-get安裝套件 itemprop=url>在Heroku上用apt-get安裝套件</a></h1></header><div class=entry-content><p><a href=https://www.heroku.com>Heroku</a>蠻好用的, 也用了好幾年了, 拿來做prototype真是方便, 不過慚愧的是, 我還沒付過錢給他(真惡劣)
最近chatbot玩得比較多, 不想花錢租server, 所以就比較頻繁的用它, 說到這裡, 照例, 先來廣告一下:</p><p>新的<a href=https://line.me/R/ti/p/%40dlk1367a>Line叭寇(Barcode)小幫手</a> (轉含有條碼的圖片給它, 它會幫你解讀):</p><p><a href=https://line.me/R/ti/p/%40dlk1367a><img src=http://qr-official.line.me/L/zMCfmfxLHk.png alt></a></p><p>好了, 回歸正題, Heroku 雖然是一個Paas的服務, 但它彈性非常大, 透過不同的buildpack也可以支援不同的語言跟框架,
不像Google的GAE, 支援的平台就比較有限</p><p>Heroku本身也是跑在Linux上, 因此, 如果你需要額外的套件, 其實也是沒問題的, 舉個例子, 雖然我這個叭寇小幫手是用Go來寫的
但卻會用到<a href=http://zbar.sourceforge.net/>ZBar</a>這個讀取條碼的C程式庫, Heroku上當然沒裝, 所以建置Go時, 會因為找不到
程式庫而失敗</p><p>在Linux上, 我們可以用<code>apt-get</code>去安裝套件, 以zbar這例子是<code>apt-get install libzbar-dev</code>, 但在Heroku上又該怎麼裝呢?</p><p>還是要透過buildpack, 在command line下執行下面指令:</p><pre><code>heroku buildpacks:add --index 1 https://github.com/heroku/heroku-buildpack-apt
</code></pre><p>apt這個build pack是放在官方的Github上, 因為我們希望該需要的, 軟體在一開始就把它準備好了</p><p>除了加build pack外, 還是不夠的, 你的套件還是沒被安裝, 因此繼續加一個叫<code>Aptfile</code>的檔案, 內容是你需要安裝的套件</p><p>當你push你的程式到heroku上後, 它就會根據<code>Aptfile</code>去安裝相對應的套件了</p></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2012-04-16 22:55:49 +0000 UTC"><a href=/%E7%AD%86%E8%A8%98-Deploy-Mojito-app-to-Heroku/>Apr 16, 2012</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~1 minute</span></div><h1 class=entry-title><a href=/%E7%AD%86%E8%A8%98-Deploy-Mojito-app-to-Heroku/ rel=bookmark title="[筆記] Deploy Mojito app to Heroku" itemprop=url>[筆記] Deploy Mojito app to Heroku</a></h1></header><div class=entry-content><div class=posterous_autopost><p>First, you need to follow this doc (<a href=http://developer.yahoo.com/cocktails/mojito/docs/quickstart/ target=_blank>http://developer.yahoo.com/cocktails/mojito/docs/quickstart/</a><a href=http://developer.yahoo.com/cocktails/mojito/docs/quickstart/ title=http://developer.yahoo.com/cocktails/mojito/docs/quickstart/ target=_blank></a><a href=http://developer.yahoo.com/cocktails/mojito/docs/quickstart/ title=http://developer.yahoo.com/cocktails/mojito/docs/quickstart/ target=_blank></a><a href=http://developer.yahoo.com/cocktails/mojito/docs/quickstart/ target=_self></a>) to install Mojito as a global node module. Why install it globally? Because you need the Mojito command line to create your first app.</p><p>Create application with command line:</p><blockquote class=posterous_short_quote><p>mojito create app mymojito</p></blockquote><p>Change working directory to &ldquo;mymojito&rdquo;.</p><p>Create a &ldquo;Procfile&rdquo; whose content is:</p><blockquote class=posterous_short_quote><p>web: mojito start $PORT</p></blockquote><p>Use the following command to create an application on heroku and deploy codes to it.</p><blockquote><ul><li>git init</li><li>git add .</li><li>git commit -am init</li><li>heroku create mymojitotest &ndash;stack cedar</li><li>git push heroku master</li></ul></blockquote><p>After successfully commit codes to heroku, you could check running process with &ldquo;heroku ps&rdquo;. However, you cannot find any running process. That is because there is one important step missed:</p><blockquote class=posterous_short_quote><p>heroku ps:scale web=1</p></blockquote><p>This command adds one dyno for web process. After that, you will find one web process when you check with &ldquo;heroku ps&rdquo;. And the server is now started up. You can check your app with browser.</p></div></div></article><article class=hentry><header><div class=entry-meta><span class="entry-date date published updated"><time datetime="2011-09-29 01:11:11 +0000 UTC"><a href=/%E7%AD%86%E8%A8%98-Building-social-networking-service-with-DIASPORA-on-Heroku/>Sep 29, 2011</a></time></span>
<span class=entry-reading-time><i class="fa fa-clock-o"></i>Reading time ~1 minute</span></div><h1 class=entry-title><a href=/%E7%AD%86%E8%A8%98-Building-social-networking-service-with-DIASPORA-on-Heroku/ rel=bookmark title="[筆記] Building social networking service with DIASPORA* on Heroku" itemprop=url>[筆記] Building social networking service with DIASPORA* on Heroku</a></h1></header><div class=entry-content><div class=posterous_autopost><div class="p_embed p_image_embed"><a href=http://posterous.com/getfile/files.posterous.com/temp-2011-09-28/yDcrGkHznnvkFfkhEjoabkEryHGaevvynvtyCEGosBbuinEijbvqtaehCjpq/_2011-09-29_12.03.19.png.scaled1000.png><img alt=_2011-09-29_12 height=392 src=http://posterous.com/getfile/files.posterous.com/temp-2011-09-28/yDcrGkHznnvkFfkhEjoabkEryHGaevvynvtyCEGosBbuinEijbvqtaehCjpq/_2011-09-29_12.03.19.png.scaled500.png width=500></a></div><p>Looks familiar? It&rsquo;s not Google+. It&rsquo;s <a href=https://joindiaspora.com/>DIASPORA</a>. An open source project that implements a distributed social networking service. This project was announced on APRIL 24, 2010 (Just right after Facebook f8 2010 that is at APRIL 21). Alpha version was released at NOV 23, 2010 (two days before my birthday :P). </p><p>According to <a href=http://mashable.com/2010/05/28/zuckerberg-diaspora/>this</a>, Mark Zuckerbug also donated to it just because it&rsquo;s a cool idea.</p><p>It&rsquo;s built on Ruby on rails. So it might be not so difficult to port it to Heroku platform which is a nice RoR host (althrough it still took me some time). It might be easier than build from scratch on a Linux. </p><p>I&rsquo;m a newbie to these two (Heroku and DIASPORA). I&rsquo;m also not familar with RoR. Here records steps I tried. </p><p><span style=font-size:medium><strong>create an application on heroku</strong></span></p><p>First, you need to create an application on Heroku. There are several platform stack on Heroku. <a href=http://devcenter.heroku.com/articles/cedar>Cedar stack</a> might be the newest and most powerful one. It supports several languages and frameworks. And It also makes it very easy to deploy RoR applications. </p><p>You need to <a href=http://devcenter.heroku.com/articles/heroku-command>install heroku CLI</a> before creating an application. And use &ldquo;<em>heroku login</em>&rdquo; to login to your heroku account.</p><p>Run the following command to create a new cedar application (assume application name is &ldquo;mysocialy&rdquo;) &ndash;</p><blockquote class=posterous_short_quote><p><em>heroku create &ndash;stack cedar mysocialy</em></p></blockquote><p>After the application created, you&rsquo;ll have a url <em>&ldquo;http://mysocialy.herokuapp.com/&rdquo;</em> for your site. And a git repository: <em><a href=mailto:git@heroku.com>git@heroku.com</a>:mysocialy.git</em></p><p><span style=font-size:medium><em><strong>import source codes</strong></em></span></p><p>Get DIASPORA* source codes from git hub:</p><blockquote class=posterous_short_quote><p><em>git clone git://github.com/diaspora/diaspora.git</em></p></blockquote><p>Get your source codes from Heroku git repository (you&rsquo;ll get an empty folder):</p><blockquote class=posterous_short_quote><p><em>git clone </em><em><a href=mailto:git@heroku.com>git@heroku.com</a>:mysocialy.git</em></p></blockquote><p>If you have trouble to download from Heroku. Try to use &ldquo;<em>heroku keys:add</em>&rdquo; to add your ssh public key and try again.</p><p>Copy all files except &ldquo;.git&rdquo; folder from &ldquo;diaspora&rdquo; to &ldquo;mysocialy&rdquo;.</p><p><span style=font-size:medium><em><strong>Initial configuration</strong></em></span></p><p>Make new configuration files from example.</p><blockquote class=posterous_short_quote><p><em>cd config</em></p><p><em>mv application.yml.example application.yml  </em></p><p><em>mv database.yml.example database.yml</em></p></blockquote><p>Edit application.yml. Make &ldquo;pod_url&rdquo; to your host. In this case:</p><blockquote class=posterous_short_quote><p><em>pod_url: &ldquo;http://mysocialy.herokuapp.com/&rdquo;</em></p></blockquote><p><em><strong><span style=font-size:medium>Deploy codes</span></strong></em></p><p>Add and commit files:</p><blockquote class=posterous_short_quote><p><em>git add .</em></p><p><em>git commit -am &lsquo;initial import&rsquo;</em></p></blockquote><p>Push them to Heroku</p><blockquote class=posterous_short_quote><p><em>git push origin master</em></p></blockquote><p>The coolest thing that Heroku does is that it makes deploy codes so easy. All you need to do is to push your codes to its git repository. And it could also install all related modules for you (that is configured in Gemfile). Super easy.</p><p>Ok, I must admit that I lie a little bit. There might be some problems. After I pushes all codes to Heroku, I found there is an error that it couldn&rsquo;t find 'pg&rsquo; (postgresSQL). Looks like it does not install into gem.</p><p>I found the answer that it might be problem with gem version. Need to run &ldquo;<em>bundle install</em>&rdquo; at local.  This will generate a new Gemfile.lock. Push this new file to Heroku might solve this problem</p><p><em><span style=font-size:medium><strong>Ok, that&rsquo;s all?</strong></span></em></p><p>Not sure if I missed anything (I might). Anyway, what I did is alive at &ldquo;<em><a href=http://mysocialy.herokuapp.com/>http://mysocialy.herokuapp.com/</a>&rdquo;.</em></p></div></div></article></div><div class=footer-wrapper><footer role=contentinfo><span>Powered by <a href=https://gohugo.io/ rel=nofollow>Hugo</a> using the <a href=https://github.com/dldx/hpstr-hugo-theme rel=nofollow>HPSTR theme</a>.</span></footer></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js></script><script src=https://kit.fontawesome.com/872a53b461.js crossorigin=anonymous></script><script>window.jQuery||document.write('<script src="\/js\/vendor\/jquery-1.9.1.min.js"><\/script>')</script><script src=/js/scripts.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-79243751-1','auto');ga('send','pageview');}</script><div id=fb-root></div><script async defer crossorigin=anonymous src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=293999444006555&autoLogAppEvents=1" nonce=geZSUIUh></script></body></html>